{% extends 'base.html' %}

{% block body %}
    <div class="row">
        {% for post in posts %}
            {% include '_card.html' %}
        {% endfor %}
    </div>

    <script> 
        // reply fomr toggle
        $('.replybutton').click(function(){
        $(this).next('.replyform_div').toggle();
        });    

        // reply create
        let replyForms = document.querySelectorAll('.reply-Form')
        replyForms.forEach(function(replyForm){
            replyForm.addEventListener('submit', function(event){
                event.preventDefault()
                const data = new FormData(event.target)
                axios.post(event.target.action, data)
                    .then(function(response){
                    const reply = response.data
                    const replyList = document.querySelector(
                        `#reply-list-${reply.postId}-${reply.commentId}`)
                    const newReply = `<div class="in">
                                ${ reply.username } : ${ reply.content }
                                <a href="/posts/${reply.postId}/comments/${reply.commentId}/replys/${reply.id}/delete">Delete</a>
                            </div>`
                    replyList.insertAdjacentHTML('beforeEnd', newReply)
                    event.target.reset()
                    })
            })
        })
    </script>
    
{% endblock %}
