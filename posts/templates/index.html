{% extends 'base.html' %}

{% block body %}
    <div class="row">
        {% for post in posts %}
            {% include '_card.html' %}
        {% endfor %}
    </div>


    // post like
    <script>
        let likeButtons = document.querySelectorAll("i.heart")

        likeButtons.forEach((likeButton)=>{            
            likeButton.addEventListener("click", (event)=>{
                let postId = event.target.dataset.postId 
                likeRequest(event.target, postId)
            })
        })

        let likeRequest = async (button, postId) => {
            let likeURL = `/posts/${postId}/likes-async/`
            let response = await fetch(likeURL)
            let result = await response.json()

            if (result.status) {
                button.classList.remove('bi-heart')
                button.classList.add('bi-heart-fill')
                button.style.color = 'red'
                button.innerHTML = result.count
                
            } else {
                button.classList.remove('bi-heart-fill')
                button.classList.add('bi-heart')
                button.style.color = 'black'
                button.innerHTML = result.count
            }
        }
    </script>


    // comment create
    <script> 
    let commentForm = document.querySelector('.comment-Form')
    commentForm.addEventListener('submit', function(event){
        event.preventDefault()
        const data = new FormData(event.target)
        axios.post(event.target.action, data)
            .then(function(response){
            const comment = response.data
            const commentList = document.querySelector(
                `#comment-list-${comment.postId}`)
            const newComment = `<div class="in">
                        ${ comment.username } : ${ comment.content }
                    </div>`
            commentList.insertAdjacentHTML('beforeEnd', newComment)
            event.target.reset()
            })
    })
    </script>


    // comment like
    <script>
        let comment_likeButtons = document.querySelectorAll("i.comment_heart")

        comment_likeButtons.forEach((comment_likeButton)=>{            
            comment_likeButton.addEventListener("click", (event)=>{
                let postId = event.target.dataset.postId
                let commentId = event.target.dataset.commentId 
                comment_likeRequest(event.target, postId, commentId)
            })
        })

        let comment_likeRequest = async (button, postId, commentId) => {
            let likeURL = `/posts/${postId}/comments/${commentId}/likes-async/`
            let response = await fetch(likeURL)
            let result = await response.json()

            if (result.status) {
                button.classList.remove('bi-heart', 'comment_heart')
                button.classList.add('bi-heart-fill', 'comment_heart')
                button.style.color = 'red'
                button.innerHTML = result.count
                
            } else {
                button.classList.remove('bi-heart-fill', 'comment_heart')
                button.classList.add('bi-heart', 'comment_heart')
                button.style.color = 'black'
                button.innerHTML = result.count
            }
        }
    </script>

{% endblock %}